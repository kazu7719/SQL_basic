### AWSでもデプロイの流れ

①ローカル環境でwebアプリケーションを開発
②Githubにコードをプッシュ
③AWSでサーバー(EC2)を起動し、データベース(RDS)とストレージ(S3)を繋ぐ
④GithubからEC2にコードをプルして、EC2内でアプリを起動してデプロイを実行

### S3について
・・・画像や動画などのデータはユーザーがいつでも見返すことができるように蓄積される
サービス側はその大量のデータを安全にそして長期的に保存しておく必要がある
このようなデータを保存するサービスのことを、ストレージサービスと言う

S3・・・AWSが提供するサービスの一つ。
ネットワーク障害に強く、画像の保存と保存の画像の取得が可能

## S3導入の流れ
①S3で画像の保存先を作成
②ローカル環境でS3に保存する処理を記述
③本番環境でS3に保存する処理を記述


# ①について
・・・S3で画像の保存先を作成する際、AWS上のブラウザ上で動くCLIを使用
かつセキュリティ対策も行う
→AWS CloudShellを使って、AWSの操作を行う

①バケット(データ保存場所)を作成
→リージョンを確認し、aws s3 mbコマンドで名前を指定しバケットを作成。
aws s3 lsでバケットの作成できたか確認

②バケット内のオブジェクト所有者の確認
→aws s3api get-bucket-ownership-controls コマンドを使用
#出力結果
{
    "OwnershipControls": {
        "Rules": [
            {
                "ObjectOwnership": "BucketOwnerEnforced"
            }
        ]
    }
}

BucketOwnerEnforcedは、オブジェクトの所有者をバケットの所有者に適用することを示す。

③バケットの暗号化を確認
バケット暗号化の種類
・クライアントサイド暗号化
→ユーザーが暗号化してからAWSにアップロードする
・サーバーサイド暗号化
→AWSにアップロードするときに暗号化
データをサーバーに保存する前に暗号化するので、不正アクセスや盗難から保護する

バケットの暗号化を確認するには、aws s3api get-bucket-encryptionコマンドを使用

④バケットのセキュリティ対策を行うために、アクセス許可の設定をする
→aws s3api get-public-access-blockコマンドを使用
これによって外部からもアクセスは全てブロックする

⑤S3へ外部からファイルがアップロードできるように、外部からのアクセスを許可する
→aws s3api put-public-access-blockコマンドを使用

⑥バケットポリシーを設定するが、IAMユーザーのみバケットにアクセスできるよう設定する
→aws iam list-usersコマンドを使用

・バケットポリシー
→バケットに対してどのようなユーザーがどのような処理をできるか取り決めするもの。処理とは、一覧表示・読み取り・書き込み・削除を指す

⑦バケットポリシーの設定を行うためにまずVSコードでs3ディレクトリにpolicy.jsonというファイルを作成
→aws s3api put-bucket-policy コマンドを設定

⑧Cloud shellにコピーし実行する
⑨aws s3api get-bucket-policy コマンドから、バケットポリシーの設定を確認

